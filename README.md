## Overview
This is a Japan stock market management tool developed in Java. It includes the following scripts:

### 1. TrendScreener.java
A stock screening script.
- Uses the list of stocks published by the Japan Exchange
- Fetches stock data from Yahoo Finance via a public HTTP interface
- Determines trends based on daily candles, volume, ADX, and other indicators
- Generates `candidatesa_DATE.csv`: a list of stocks selected by the algorithm that are currently in an upward trend

### 2. CsvWindowRanker.java
A summarization and ranking script.
- Reads `candidatesa_DATE.csv` files generated by `TrendScreener.java` within a time window (default: 15 days)
- Scores each stock based on multiple indicators
- Selects the top 50 stocks with the best trend performance over the past 15 days
- Generates `window_rank_DATE.csv`: a ranked list of candidate buy targets

### 3. TrendSellAdvisor.java
A position management (risk control) script.
- Stores current positions in `resource/positions.xlsx` (ticker, shares, entry price, date, layer, etc.)
- Layer: a risk-control metric. A fixed capital amount (e.g., JPY 100,000) equals 1 layer; if a stock position uses JPY 200,000, it is 2 layers. The higher the layer, the stricter the risk rules
- Fetches current holding stock data from Yahoo Finance via a public HTTP interface
- Applies a set of risk-control rules (including daily trend rules, momentum decay, gap moves, etc.) to decide:
  - whether to sell
  - what percentage to sell
- Generates `decisions_DATE.csv`: outputs sell decisions and suggested sell ratios

### 4. RankTsvBacktester.java
A reliability validation (backtesting) script.
- Reads previously generated `window_rank_DATE.csv` (e.g., from one month ago)
- Fetches historical data from Yahoo Finance via a public HTTP interface and calculates the price change over the period
- If drawdowns are large, it suggests that the parameters in `TrendScreener.java` may need adjustment

### 5. GptRanker.java (News/Sentiment Scorer, currently disabled)
- Scrapes news headlines from the Kabutan (株探) stock news pages
- Calls the ChatGPT 4.0 API to generate a news/sentiment score for stocks that show reversal signals in `candidatesa_DATE.csv`
- Combines the sentiment score with fundamental data in `candidatesa_DATE.csv` to produce a final score and ranking
- This approach was not accurate enough, so the related logic is currently commented out
- To enable it:
  1. Restore the commented code in `TrendScreener.java`
  2. Apply for a ChatGPT developer account
  3. Configure the ChatGPT API key in your runtime environment
- Configuration example:
  - `OPENAI_API_KEY=your_openai_api_key`

---

## Usage
- Run `TrendScreener.java` after each trading day to generate screening results
- Run `CsvWindowRanker.java` about once every 1–2 weeks to identify buy candidates for that period
- Update `positions.xlsx` whenever you buy or sell
- Run `TrendSellAdvisor.java` after each trading day to check whether any current holdings hit risk-control rules and to get suggested sell ratios

---

## Disclaimer
This project does not constitute investment advice. Trading involves risk—please make decisions at your own discretion.

## 基本介绍
这是一套基于 Java 开发的日本市场股票管理工具，包含以下脚本：

### 1. TrendScreener.java
股票筛选算法脚本。  
- 使用日本交易所公布的股票列表  
- 从雅虎股票 HTTP 公开接口获取股票信息  
- 根据日线、成交量、ADX 等指标判断趋势  
- 生成 `candidatesa_日期.csv`：由算法筛选出的、当前市场趋势向上的股票列表

### 2. CsvWindowRanker.java
总结与排名脚本。  
- 读取一定时间窗口内（默认 15 天）由 `TrendScreener.java` 生成的 `candidatesa_日期.csv` 文件  
- 对其中股票的各项指标进行打分  
- 选出过去 15 天内趋势最好的 50 只股票  
- 生成 `window_rank_日期.csv`：这些股票即为买入目标候选列表

### 3. TrendSellAdvisor.java
仓位管理（风控）脚本。  
- 将当前持仓信息输入到 `resource/positions.xlsx`（股票代码、股数、买入价格、日期、层数等）  
- 层数：风控指标。以固定资金量（例如 10 万日元）为 1 层；若某只股票投入资金为 20 万日元，则为 2 层。层数越高，风控规则越严格  
- 从雅虎股票 HTTP 公开接口获取当前持仓股票信息  
- 使用一系列风控规则（包含日线、动量衰减、跳空等）判断：
  - 该不该卖出  
  - 应该卖出多少比例  
- 生成 `decisions_日期.csv`：输出卖出决策与比例建议

### 4. RankTsvBacktester.java
可靠性验证（回测）脚本。  
- 读取过去生成的 `window_rank_日期.csv`（例如一个月前）  
- 根据雅虎股票 HTTP 公开接口获取的历史数据，计算这段时间内这些股票的涨跌幅  
- 若跌幅较大，说明 `TrendScreener.java` 的算法可能存在问题，需要调整参数

### 5. GptRanker.java（消息面打分器，当前已停用）

- 爬取株探し网站上股票新闻页面的标题  
- 调用 ChatGPT 4.0 接口，为 `candidatesa_日期.csv` 中出现反转信号的股票生成消息面分数  
- 再结合 `candidatesa_日期.csv` 中的基本面信息，输出综合分数与排名  
- 由于该方法准确度不高，目前相关逻辑已被注释掉  
- 如需启用：
  1. 恢复 `TrendScreener.java` 内的相关注释代码  
  2. 申请 ChatGPT 开发者账号  
  3. 在启动环境中配置 ChatGPT API Key
- 配置示例：
OPENAI_API_KEY=你的openAPI key
---

## 使用方法
- 每个交易日盘后运行一次 `TrendScreener.java`，生成股票筛选数据  
- 大约每 1～2 周运行一次 `CsvWindowRanker.java`，判断这段时期有哪些股票可作为买入目标  
- 当持仓发生买入/卖出时，更新 `positions.xlsx`  
- 每个交易日盘后运行一次 `TrendSellAdvisor.java`，判断当前持仓中是否有触发风控需要卖出的股票及卖出比例

---

## 免责声明
本项目不构成任何交易建议。交易有风险，入市需谨慎。



# 日本株トレンド管理ツール（Java）

## 概要
本プロジェクトは、**Java で開発した日本株向けの銘柄管理・売買判断補助ツール**です。  
JPX（日本取引所）が公開している銘柄一覧を対象に、**Yahoo!ファイナンスの公開ページ（HTTP）**から株価データを取得し、日足・出来高・ADX などの指標を用いてトレンド判定を行います。

> **注意**：本プロジェクトは投資助言ではありません。最終判断は自己責任でお願いします。  
> **データ取得について**：公開ページの取得（スクレイピング/HTML解析等）は、提供元の仕様変更・利用規約・アクセス制限等の影響を受ける可能性があります。各提供元の規約を遵守し、必要に応じて取得頻度制限やキャッシュを導入してください。

---

## スクリプト一覧

### 1. `TrendScreener.java`
**銘柄スクリーニング**を行うスクリプトです。  
- JPX 公開銘柄を対象に、Yahoo!ファイナンスの公開ページ（HTTP）から株価データを取得  
- 日足、出来高、ADX などの指標からトレンド判定を行い、上昇トレンド候補を抽出  
- 出力：`candidatesa_日付.csv`  
  - アルゴリズムで抽出された「現在、上昇トレンドにある銘柄」リスト

### 2. `CsvWindowRanker.java`
**集計・ランキング**を行うスクリプトです。  
- 直近一定期間（デフォルト：15日）に生成された `candidatesa_日付.csv` を読み込み  
- 対象銘柄の各指標をスコアリングし、直近期間で最も強いトレンドの銘柄（例：上位50銘柄）を抽出  
- 出力：`window_rank_日付.csv`  
  - 買い候補の優先順位リスト

### 3. `TrendSellAdvisor.java`
**ポジション管理（リスク管理）**を行うスクリプトです。  
- 保有銘柄情報（銘柄コード、株数、取得価格、取得日、レイヤー等）を `resources/positions.xlsx` に入力  
- Yahoo!ファイナンスの公開ページ（HTTP）から最新データを取得し、複数のリスク管理ルールで売却判断を算出  
  - 日足条件  
  - モメンタム減衰  
  - ギャップ（窓）など  
- 出力：`decisions_日付.csv`  
  - 売却すべきか、売却比率はどれくらいかの提案

#### レイヤー（層）について
本ツール内のリスク管理指標です。  
一定の資金量（例：10万円）を1レイヤーとし、銘柄ごとの投入資金が20万円なら2レイヤーといった考え方です。  
レイヤーが高いほどリスク管理ルールを厳しくする目的で利用します（一般的な金融用語としての定義ではありません）。

### 4. `RankTsvBacktester.java`
**信頼性検証（バックテスト）**を行うスクリプトです。  
- 過去に生成した `window_rank_日付.csv`（例：1か月前）を読み込み  
- Yahoo!ファイナンスの公開ページ（HTTP）から株価を取得し、一定期間後の騰落率を計算  
- もし大きな下落が多い場合、`TrendScreener.java` のパラメータ見直しが必要な可能性があります

### 5. `GptRanker.java`（ニュース・材料スコアリング ※現在は無効化）
**ニュース見出しを用いた材料面スコアリング**の試みです。  
- 株探（かぶたん）等のニュースページから銘柄ニュース見出しを取得  
- ChatGPT API（例：GPT-4.0）を用いて、`candidatesa_日付.csv` 内で反転シグナルが出た銘柄に材料スコアを付与  
- その後、（基本面スコア等と合わせて）ランキング化する想定  
- ただし精度が十分ではないと感じたため、現状は `TrendScreener.java` 側で該当部分をコメントアウトしています

利用する場合：
- `TrendScreener.java` のコメントアウトを戻す  
- OpenAI API キーを取得し、実行環境に設定する  
- **APIキーはリポジトリにコミットしないこと**
- 設定例：OPENAI_API_KEY=あなたのOpenAI APIキー

---

## 使い方（運用フロー）
1. **毎取引日・引け後**に `TrendScreener.java` を実行し、スクリーニング結果を生成  
2. **1〜2週間に1回**程度 `CsvWindowRanker.java` を実行し、その期間で買い候補を絞り込み  
3. 売買が発生したら `resources/positions.xlsx` を更新  
4. **毎取引日・引け後**に `TrendSellAdvisor.java` を実行し、保有銘柄のリスク管理（売却判断）を更新  
5. 必要に応じて `RankTsvBacktester.java` で過去ランキングの成績を検証し、パラメータを調整

---

## 免責事項
本プロジェクトは投資助言を目的としたものではありません。  
投資にはリスクが伴います。最終的な投資判断は自己責任で行ってください。
